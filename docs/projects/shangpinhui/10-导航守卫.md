# 导航守卫

> 导航表示路由正在发生变化，要进行路由跳转；守卫会对跳转进行限制，符合条件才放行。守卫分三种：全局（前置和后置）、路由独享守卫、组件内守卫。这些导航守卫要定义在 src/router/index.js 里的路由实例 router 下面。在[ 这里 ](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html)可以查看 vue2 详细的官方文档。

## 1. **全局前置守卫**

- 例 1：当用户未登录，全局前置守卫负责将其带到登录页面。

![image.png](/images/导航1.png)

- 例 2（重点）：访问任何页面时，token 校验机制全过程

  ![image.png](/images/导航2.png)

  - 存在问题 1：根据这样的代码可以成功拦截用户的非法访问行为，但存在一个问题，游客在访问交易类型页面时，会自动跳转至登录页，按照需求来说，登录成功后应该重定向到用户的目标地址，但由于我们在写登录页的代码时，登陆成功后是毫无疑问跳转到 Home 主页的，这就产生了分歧。所以我们要更改 Login 模块无条件跳转 Home 主页的代码，应该先判断$route.query 中是否有 redirect 参数，有则重定向，否则才跳转至 Home。

  ![image.png](/images/导航3.png)

  这张截图是“立即登录”按钮的点击事件，灰框内容是原来写的，红框是改善后的。

  - 存在问题 2：交易成功的页面是不能直接访问的，只能由用户在支付页面支付成功后跳转。这个问题需要用“路由独享守卫”来解决。

## 2. 路由独享守卫

- 思路：见上述存在问题 2
- 代码：在路由 index.js 中进行以下改善。

![image.png](/images/导航4.png)

同理，进入提交订单页面（Trade）只能从购物车页面跳转，进入加购成功（addCartSuccess）只能从商品详情页面跳转。

## 3. 组件内守卫（使用较少）

- 用途：也能解决存在问题 2。
- 代码

![image.png](/images/导航5.png)
